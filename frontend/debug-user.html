<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug User Info</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .info { margin: 10px 0; padding: 10px; background: #f5f5f5; border-radius: 5px; }
        .error { background: #ffe6e6; color: #d00; }
        .success { background: #e6ffe6; color: #0a0; }
    </style>
</head>
<body>
    <h1>Debug User Information</h1>
    
    <div id="userInfo"></div>
    
    <button onclick="clearStorage()">Clear All Storage</button>
    <button onclick="checkAuth()">Check Auth</button>
    
    <script src="js/auth.js"></script>
    <script>
        function displayUserInfo() {
            const infoDiv = document.getElementById('userInfo');
            
            // Check localStorage
            const userDataRaw = localStorage.getItem('currentUser');
            const tokenRaw = localStorage.getItem('authToken');
            
            let html = '<h3>LocalStorage Data:</h3>';
            html += `<div class="info">currentUser: ${userDataRaw || 'null'}</div>`;
            html += `<div class="info">authToken: ${tokenRaw || 'null'}</div>`;
            
            // Try to parse user data
            if (userDataRaw) {
                try {
                    const userData = JSON.parse(userDataRaw);
                    html += '<h3>Parsed User Data:</h3>';
                    html += `<div class="info">ID: ${userData.id || 'N/A'}</div>`;
                    html += `<div class="info">Username: ${userData.username || 'N/A'}</div>`;
                    html += `<div class="info">Email: ${userData.email || 'N/A'}</div>`;
                    html += `<div class="info">Role: ${userData.role || 'N/A'}</div>`;
                    html += `<div class="info">Full Name: ${userData.full_name || 'N/A'}</div>`;
                } catch (e) {
                    html += `<div class="error">Error parsing user data: ${e.message}</div>`;
                }
            }
            
            // Test currentUser() function
            html += '<h3>currentUser() Function Result:</h3>';
            try {
                const user = currentUser();
                if (user) {
                    html += `<div class="success">User found: ${JSON.stringify(user, null, 2)}</div>`;
                } else {
                    html += `<div class="error">currentUser() returned null</div>`;
                }
            } catch (e) {
                html += `<div class="error">Error calling currentUser(): ${e.message}</div>`;
            }
            
            infoDiv.innerHTML = html;
        }
        
        function clearStorage() {
            localStorage.clear();
            sessionStorage.clear();
            alert('Storage cleared!');
            displayUserInfo();
        }
        
        function checkAuth() {
            console.log('Testing requireAuth with OWNER role...');
            const result = requireAuth(['OWNER']);
            if (result !== null) {
                alert('Auth check passed!');
            }
        }
        
        // Display info on page load
        displayUserInfo();
        
        // Also log to console
        console.log('=== Debug User Info ===');
        console.log('localStorage currentUser:', localStorage.getItem('currentUser'));
        console.log('localStorage authToken:', localStorage.getItem('authToken'));
        console.log('currentUser() result:', currentUser());
    </script>
</body>
</html>
